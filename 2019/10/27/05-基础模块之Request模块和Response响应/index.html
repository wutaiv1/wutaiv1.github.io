<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.4"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.4"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><title>05 基础模块之Request模块和Response响应 | 吴泰的博客</title></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">05 基础模块之Request模块和Response响应</h1><a id="logo" href="/.">吴泰的博客</a><p class="description">学海无涯,不进则退</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="搜索"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">05 基础模块之Request模块和Response响应</h1><div class="post-meta"><a href="/2019/10/27/05-基础模块之Request模块和Response响应/#comments" class="comment-count"></a><p><span class="date">Oct 27, 2019</span><span><a href="/categories/爬虫/" class="category">爬虫</a></span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><p>简介:介绍request 模块和Response对象</p>
<a id="more"></a>

<h2 id="5、request-模块"><a href="#5、request-模块" class="headerlink" title="5、request 模块"></a>5、request 模块</h2><p>请求方式：主要有GET和POST两种类型，另外还有HEAD、PUT、DELETE、OPTIONS等</p>
<p>请求URL：URL全称统一资源定位符，每个网页、图片、视频使用URL来唯一确定。</p>
<p>请求头：包含请求时头部信息，如User-Agent、Host、Cookies等信息。</p>
<p>请求体: 请求时额外携带的数据，如表单提交时的表单数据。</p>
<p>Requests 是用Python语言编写的，基于urllib库，比urllib库更加好用的Http库</p>
<p>安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install requests</span><br></pre></td></tr></table></figure>

<h3 id="5-1-基本语法"><a href="#5-1-基本语法" class="headerlink" title="5.1 基本语法"></a>5.1 基本语法</h3><p><strong>requests模块支持的请求</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">requests.get(<span class="string">"http://httpbin.org/get"</span>)</span><br><span class="line">requests.post(<span class="string">"http://httpbin.org/post"</span>)</span><br><span class="line">requests.put(<span class="string">"http://httpbin.org/put"</span>)</span><br><span class="line">requests.delete(<span class="string">"http://httpbin.org/delete"</span>)</span><br><span class="line">requests.head(<span class="string">"http://httpbin.org/get"</span>)</span><br><span class="line">requests.options(<span class="string">"http://httpbin.org/get"</span>)</span><br></pre></td></tr></table></figure>

<h3 id="5-2-get请求"><a href="#5-2-get请求" class="headerlink" title="5.2 get请求"></a>5.2 get请求</h3><h4 id="5-2-1、基本请求"><a href="#5-2-1、基本请求" class="headerlink" title="5.2.1、基本请求"></a>5.2.1、基本请求</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">response=requests.get(<span class="string">'https://www.jd.com/'</span>,)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"jd.html"</span>,<span class="string">"wb"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(response.content)</span><br></pre></td></tr></table></figure>

<p>返回的是response对象，response.content 返回的是二进制对象，所有使用wb模式写; 如果是response.content 返回的是文本字符串，使用”w” 模式写。</p>
<p>==注意网站和本地字符串编码，有的网站是gbk，有的是utf-8==</p>
<p>显示网页内容，使用text方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">response=requests.get(<span class="string">'https://www.jd.com/'</span>)</span><br><span class="line"></span><br><span class="line">print(response.text) <span class="comment"># 显示京东页面</span></span><br></pre></td></tr></table></figure>

<h4 id="5-2-2、含参数的请求"><a href="#5-2-2、含参数的请求" class="headerlink" title="5.2.2、含参数的请求"></a>5.2.2、含参数的请求</h4><p>request 请求时使用 <strong>params参数</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">response=requests.get(<span class="string">'https://s.taobao.com/search?q=手机'</span>) </span><br><span class="line">response=requests.get(<span class="string">'https://s.taobao.com/search'</span>,params=&#123;<span class="string">"q"</span>:<span class="string">"美女"</span>&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'alex'</span>,</span><br><span class="line">    <span class="string">'age'</span>: <span class="number">23</span></span><br><span class="line">&#125;</span><br><span class="line">response=requests.get(<span class="string">'https://httpbin.org/get'</span>, params=data)</span><br><span class="line"></span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>

<p>结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;args&quot;: &#123;</span><br><span class="line">    &quot;age&quot;: &quot;23&quot;, </span><br><span class="line">    &quot;name&quot;: &quot;alex&quot;</span><br><span class="line">  &#125;, </span><br><span class="line">  &quot;headers&quot;: &#123;</span><br><span class="line">    &quot;Accept&quot;: &quot;*/*&quot;, </span><br><span class="line">    &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;, </span><br><span class="line">    &quot;Host&quot;: &quot;httpbin.org&quot;, </span><br><span class="line">    &quot;User-Agent&quot;: &quot;python-requests/2.22.0&quot;</span><br><span class="line">  &#125;, </span><br><span class="line">  &quot;origin&quot;: &quot;111.196.243.241, 111.196.243.241&quot;, </span><br><span class="line">  &quot;url&quot;: &quot;https://httpbin.org/get?name=alex&amp;age=23&quot;   # url 带参数</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-2-3、含请求头的请求"><a href="#5-2-3、含请求头的请求" class="headerlink" title="5.2.3、含请求头的请求"></a>5.2.3、含请求头的请求</h4><p>request 请求时使用 <strong>headers参数</strong><br>User-Agent是请求时，设备的信息；一些网站，做些反爬，简单的做法，判断是否有User-Agent ,没有则不会允许访问；</p>
<p>示例1:  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">response=requests.get(<span class="string">'https://dig.chouti.com/'</span>,</span><br><span class="line">                      headers=&#123;</span><br><span class="line">                     <span class="string">'User-Agent'</span>:<span class="string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.75 Safari/537.36'</span>,</span><br><span class="line">                              &#125;</span><br><span class="line">                     )</span><br></pre></td></tr></table></figure>

<p>如果不加请求头，抽屉网，返回<br><strong>你的请求带不合法参数，已被拦截！请误恶意提交</strong> 的页面</p>
<p>示例2:  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">res=requests.post(<span class="string">'https://www.lagou.com/jobs/positionAjax.json'</span>,</span><br><span class="line">             headers=&#123;</span><br><span class="line">                    <span class="string">'Referer'</span>:<span class="string">"https://www.lagou.com/jobs/list_python"</span>,</span><br><span class="line">                     <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36'</span>,</span><br><span class="line"></span><br><span class="line">             &#125;,</span><br><span class="line">             data=&#123;</span><br><span class="line">                 <span class="string">'first'</span>:<span class="literal">True</span>,</span><br><span class="line">                 <span class="string">'pn'</span>:<span class="number">2</span>,</span><br><span class="line">                 <span class="string">'kd'</span>:<span class="string">'java高级开发'</span></span><br><span class="line">             &#125;,</span><br><span class="line">             params=&#123;</span><br><span class="line">                 <span class="string">'gj'</span>: <span class="string">'3年及以下'</span>,</span><br><span class="line">                 <span class="string">'px'</span>: <span class="string">'default'</span>,</span><br><span class="line">                 <span class="string">'yx'</span>: <span class="string">'25k-50k'</span>,</span><br><span class="line">                 <span class="string">'city'</span>: <span class="string">'北京'</span>,</span><br><span class="line">                 <span class="string">'needAddtionalResult'</span>: <span class="literal">False</span>,</span><br><span class="line">                 <span class="string">'isSchoolJob'</span>: <span class="number">0</span></span><br><span class="line">             &#125;</span><br><span class="line">             )</span><br><span class="line"></span><br><span class="line">comapines_list=r6.json()</span><br><span class="line"></span><br><span class="line">print(comapines_list)</span><br></pre></td></tr></table></figure>

<h4 id="5-2-4、-含cookies请求"><a href="#5-2-4、-含cookies请求" class="headerlink" title="5.2.4、 含cookies请求"></a>5.2.4、 含cookies请求</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://httpbin.org/cookies'</span></span><br><span class="line">cookies = dict(sbid=str(uuid.uuid4()))</span><br><span class="line"></span><br><span class="line">res = requests.get(url, cookies=cookies)</span><br><span class="line">print(res.json())</span><br></pre></td></tr></table></figure>

<h4 id="5-2-5、-request-session"><a href="#5-2-5、-request-session" class="headerlink" title="5.2.5、 request.session()"></a>5.2.5、 request.session()</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># res=requests.get("https://www.zhihu.com/explore")</span></span><br><span class="line"><span class="comment"># print(res.cookies.get_dict())</span></span><br><span class="line"></span><br><span class="line">session=requests.session()</span><br><span class="line">res1=session.get(<span class="string">"https://www.zhihu.com/explore"</span>)</span><br><span class="line">print(session.cookies.get_dict())</span><br><span class="line">res2=session.get(<span class="string">"https://www.zhihu.com/question/30565354/answer/463324517"</span>,cookies=&#123;<span class="string">"abs"</span>:<span class="string">"123"</span>&#125;)</span><br></pre></td></tr></table></figure>

<p>会话维持<br>模拟登陆</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="comment"># http://httpbin.org/coookies/set  是设置cookie的方式</span></span><br><span class="line">requests.get(<span class="string">'http://httpbin.org/coookies/set/number/12345'</span>)  <span class="comment"># 访问一次页面</span></span><br><span class="line"><span class="comment"># http://httpbin.org/cookies 是获取cookies的方式</span></span><br><span class="line">response = requests.get(<span class="string">'http://httpbin.org/cookies'</span>) <span class="comment"># 获取访问该网站的cookies值</span></span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>

<p>结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;cookies&quot;: &#123;&#125;   # cookie 没有被保存</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用session 维持会话,如果不使用session ，上面的2次请求，相当从2个浏览器器访问地址，<br>使用session ,保持了连接，保持了cookie, 2次请求相当在一个浏览器上发起的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">s=requests.session()</span><br><span class="line"><span class="comment"># 第一次连接</span></span><br><span class="line">s.get(<span class="string">'http://httpbin.org/cookies/set/number/12345'</span>)</span><br><span class="line"><span class="comment"># 连接没有中断 ，再次获取cookie 值，</span></span><br><span class="line">response = s.get(<span class="string">'http://httpbin.org/cookies'</span>)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>

<p>结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;cookies&quot;: &#123;</span><br><span class="line">    &quot;number&quot;: &quot;12345&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-post请求"><a href="#5-3-post请求" class="headerlink" title="5.3 post请求"></a>5.3 post请求</h3><h4 id="5-3-1-data参数"><a href="#5-3-1-data参数" class="headerlink" title="5.3.1 data参数"></a>5.3.1 data参数</h4><p>requests.post()用法与requests.get()完全一致，特殊的是requests.post()多了一个data参数，用来存放请求体数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response=requests.post(<span class="string">"http://httpbin.org/post"</span>,params=&#123;<span class="string">"a"</span>:<span class="string">"10"</span>&#125;, data=&#123;<span class="string">"name"</span>:<span class="string">"yuan"</span>&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="5-3-2-发送json数据"><a href="#5-3-2-发送json数据" class="headerlink" title="5.3.2 发送json数据"></a>5.3.2 发送json数据</h4><p>data 默认是form 提交；<br>json 是json 数据；</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">res1=requests.post(url=<span class="string">'http://httpbin.org/post'</span>, data=&#123;<span class="string">'name'</span>:<span class="string">'yuan'</span>&#125;) <span class="comment">#没有指定请求头,#默认的请求头:application/x-www-form-urlencoed</span></span><br><span class="line">print(res1.json())</span><br><span class="line"></span><br><span class="line">res2=requests.post(url=<span class="string">'http://httpbin.org/post'</span>,json=&#123;<span class="string">'age'</span>:<span class="string">"22"</span>,&#125;) <span class="comment">#默认的请求头:application/json)</span></span><br><span class="line">print(res2.json())</span><br><span class="line">`</span><br></pre></td></tr></table></figure>

<p>下面是提交from和json数据，响应有所不同</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">res1=requests.post(&quot;http://httpbin.org/post&quot;,headers=&#123;&#125;,cookies=&#123;&#125;,params=&#123;&quot;a&quot;:&quot;1&quot;&#125;,data=&#123;&quot;a&quot;:1234&#125;)</span><br><span class="line">res2=requests.post(&quot;http://httpbin.org/post&quot;,headers=&#123;&#125;,cookies=&#123;&#125;,params=&#123;&quot;a&quot;:&quot;1&quot;&#125;,json=&#123;&quot;a&quot;:1234&#125;)</span><br><span class="line">print(res1.text)</span><br><span class="line">print(res2.text)</span><br></pre></td></tr></table></figure>

<p>res1.txt : 提交的数据在from表单内，data 内无</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;args&quot;: &#123;</span><br><span class="line">    &quot;a&quot;: &quot;1&quot;</span><br><span class="line">  &#125;, </span><br><span class="line">  &quot;data&quot;: &quot;&quot;, </span><br><span class="line">  &quot;files&quot;: &#123;&#125;, </span><br><span class="line">  &quot;form&quot;: &#123;</span><br><span class="line">    &quot;a&quot;: &quot;1234&quot;</span><br><span class="line">  &#125;, </span><br><span class="line">  &quot;headers&quot;: &#123;</span><br><span class="line">    &quot;Accept&quot;: &quot;*/*&quot;, </span><br><span class="line">    &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;, </span><br><span class="line">    &quot;Connection&quot;: &quot;close&quot;, </span><br><span class="line">    &quot;Content-Length&quot;: &quot;6&quot;, </span><br><span class="line">    &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;, </span><br><span class="line">    &quot;Host&quot;: &quot;httpbin.org&quot;, </span><br><span class="line">    &quot;User-Agent&quot;: &quot;python-requests/2.19.1&quot;</span><br><span class="line">  &#125;, </span><br><span class="line">  &quot;json&quot;: null, </span><br><span class="line">  &quot;origin&quot;: &quot;111.196.241.53&quot;, </span><br><span class="line">  &quot;url&quot;: &quot;http://httpbin.org/post?a=1&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>res2.txt 提交的数据是json 数据类型，数据存放在data 内，from 内没有数据，json 字段内也有数据；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;args&quot;: &#123;</span><br><span class="line">    &quot;a&quot;: &quot;1&quot;</span><br><span class="line">  &#125;, </span><br><span class="line">  &quot;data&quot;: &quot;&#123;\&quot;a\&quot;: 1234&#125;&quot;, </span><br><span class="line">  &quot;files&quot;: &#123;&#125;, </span><br><span class="line">  &quot;form&quot;: &#123;&#125;, </span><br><span class="line">  &quot;headers&quot;: &#123;</span><br><span class="line">    &quot;Accept&quot;: &quot;*/*&quot;, </span><br><span class="line">    &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;, </span><br><span class="line">    &quot;Connection&quot;: &quot;close&quot;, </span><br><span class="line">    &quot;Content-Length&quot;: &quot;11&quot;, </span><br><span class="line">    &quot;Content-Type&quot;: &quot;application/json&quot;, </span><br><span class="line">    &quot;Host&quot;: &quot;httpbin.org&quot;, </span><br><span class="line">    &quot;User-Agent&quot;: &quot;python-requests/2.19.1&quot;</span><br><span class="line">  &#125;, </span><br><span class="line">  &quot;json&quot;: &#123;</span><br><span class="line">    &quot;a&quot;: 1234</span><br><span class="line">  &#125;, </span><br><span class="line">  &quot;origin&quot;: &quot;111.196.241.53&quot;, </span><br><span class="line">  &quot;url&quot;: &quot;http://httpbin.org/post?a=1&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-3-3-文件上传"><a href="#5-3-3-文件上传" class="headerlink" title="5.3.3  文件上传"></a>5.3.3  文件上传</h4><p>open: 打卡文件并返回流</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">files = &#123;<span class="string">'file'</span>:open(<span class="string">'a.png'</span>,<span class="string">'rb'</span>)&#125;</span><br><span class="line">response = requests.post(<span class="string">'https://httpbin.org/post'</span>,files=files)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>

<h3 id="5-4-Response对象"><a href="#5-4-Response对象" class="headerlink" title="5.4 Response对象"></a>5.4 Response对象</h3><p>响应状态: 200成功、301跳转、404 无页面、502 服务器错误</p>
<p>响应头: 如内容类型、内容长度、服务器信息、设置Cookie等</p>
<p>响应体: 最主要部分，包含请求资源的内容，如HTML、图片二进制数据等。</p>
<h4 id="5-4-1-常见属性"><a href="#5-4-1-常见属性" class="headerlink" title="5.4.1 常见属性"></a>5.4.1 常见属性</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">respone=requests.get(<span class="string">'https://sh.lianjia.com/ershoufang/'</span>)</span><br><span class="line"><span class="comment"># respone属性</span></span><br><span class="line">print(respone.text)      <span class="comment"># 字符串数据</span></span><br><span class="line">print(respone.content)   <span class="comment"># 二进制数据</span></span><br><span class="line">print(respone.status_code) <span class="comment"># 状态吗</span></span><br><span class="line">print(respone.headers)   <span class="comment"># 请求头</span></span><br><span class="line">print(respone.cookies)   <span class="comment"># cookies 信息</span></span><br><span class="line">print(respone.cookies.get_dict()) <span class="comment"># </span></span><br><span class="line">print(respone.cookies.items())</span><br><span class="line">print(respone.url)      <span class="comment"># 显示url </span></span><br><span class="line">print(respone.history)  <span class="comment"># 如果重定向，历史网址存在里面</span></span><br><span class="line">print(respone.encoding) <span class="comment"># 编码</span></span><br><span class="line"></span><br><span class="line"> response.iter_content()  <span class="comment"># 内容可迭代，方便下载</span></span><br></pre></td></tr></table></figure>

<h4 id="5-4-2-编码问题"><a href="#5-4-2-编码问题" class="headerlink" title="5.4.2 编码问题"></a>5.4.2 编码问题</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">response=requests.get(<span class="string">'http://www.autohome.com/news'</span>)</span><br><span class="line"><span class="comment">#response.encoding='gbk' #汽车之家网站返回的页面内容为gb2312编码的，而requests的默认编码为ISO-8859-1，如果不设置成gbk则中文乱码</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"res.html"</span>,<span class="string">"w"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(response.text)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">response = requests.get(<span class="string">'url'</span>)</span><br><span class="line">response.encoding = response.apparent_encoding</span><br><span class="line">这样可以解决<span class="number">99.99</span>%的乱码</span><br><span class="line">爬取网页中response.encoding:如果header中不存在charset,则默认编码为ISO<span class="number">-8859</span><span class="number">-1</span></span><br><span class="line">而response.apparent_encoding他是一个备用编码方式,他会根据内容自动匹配给你个合适的编码方式</span><br><span class="line">那为什么只能<span class="number">99.99</span>%而不是<span class="number">100</span>%解决,还有可能就是网站开发者故意放<span class="number">2</span>种编码进去隐藏一些重要信息</span><br></pre></td></tr></table></figure>

<h4 id="5-4-3-下载二进制文件（图片，视频，音频）"><a href="#5-4-3-下载二进制文件（图片，视频，音频）" class="headerlink" title="5.4.3 下载二进制文件（图片，视频，音频）"></a>5.4.3 下载二进制文件（图片，视频，音频）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">response=requests.get(<span class="string">'http://bangimg1.dahe.cn/forum/201612/10/200447p36yk96im76vatyk.jpg'</span>)</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"res.png"</span>,<span class="string">"wb"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="comment"># f.write(response.content) # 比如下载视频时,如果视频100G,用response.content然后一下子写到文件中是不合理的</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> response.iter_content():  <span class="comment"># 将内容可迭代，不是一下下载所有的内容</span></span><br><span class="line">        f.write(line)</span><br></pre></td></tr></table></figure>

<p>网上随便找张图片，复制链接地址，下载到本地</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">'https://c-ssl.duitang.com/uploads/item/201704/21/20170421083329_3cxt8.thumb.700_0.png'</span>)</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"a.png"</span>,<span class="string">"wb"</span>) <span class="keyword">as</span> f:   <span class="comment"># 以二进制的方式写入</span></span><br><span class="line">    f.write(response.content)  <span class="comment"># 图片小，可以一下下载所有内容</span></span><br></pre></td></tr></table></figure>

<h4 id="5-4-4-解析json数据"><a href="#5-4-4-解析json数据" class="headerlink" title="5.4.4 解析json数据　　"></a>5.4.4 解析json数据　　</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">response=requests.get(<span class="string">'http://httpbin.org/get'</span>)</span><br><span class="line">res1=json.loads(response.text) <span class="comment">#太麻烦</span></span><br><span class="line">res2=response.json() <span class="comment">#直接获取json数据</span></span><br><span class="line">print(res1==res2)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">'https://httpbin.org/get'</span>)</span><br><span class="line">print(type(response.text))   <span class="comment"># 获取的是字符串类型</span></span><br><span class="line">print(response.json())   <span class="comment"># 进行json序列化</span></span><br><span class="line">print(json.loads(response.text))  <span class="comment"># 本地json 对字符串进行序列化</span></span><br><span class="line">print(type(response.json())) <span class="comment"># requests 的json后是一个字典，和使用本地json模块是相同的效果</span></span><br></pre></td></tr></table></figure>

<p>结果</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">str</span>'&gt;</span></span><br><span class="line">&#123;'args': &#123;&#125;, 'headers': &#123;'Accept': '*/*', 'Accept-Encoding': 'gzip, deflate', 'Host': 'httpbin.org', 'User-Agent': 'python-requests/2.22.0'&#125;, 'origin': '111.196.243.241, 111.196.243.241', 'url': 'https://httpbin.org/get'&#125;</span><br><span class="line">&#123;<span class="string">'args'</span>: &#123;&#125;, <span class="string">'headers'</span>: &#123;<span class="string">'Accept'</span>: <span class="string">'*/*'</span>, <span class="string">'Accept-Encoding'</span>: <span class="string">'gzip, deflate'</span>, <span class="string">'Host'</span>: <span class="string">'httpbin.org'</span>, <span class="string">'User-Agent'</span>: <span class="string">'python-requests/2.22.0'</span>&#125;, <span class="string">'origin'</span>: <span class="string">'111.196.243.241, 111.196.243.241'</span>, <span class="string">'url'</span>: <span class="string">'https://httpbin.org/get'</span>&#125;</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">dict</span>'&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="5-4-5-Redirection-and-History"><a href="#5-4-5-Redirection-and-History" class="headerlink" title="5.4.5 Redirection and History"></a>5.4.5 Redirection and History</h4><p>默认情况下，除了 HEAD, Requests 会自动处理所有重定向。可以使用响应对象的 history 方法来追踪重定向。<strong>Response.history 是一个 Response 对象的==列表==</strong>，为了完成请求而创建了这些对象。这个对象列表按照从最老到最近的请求进行排序。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.get(<span class="string">'http://github.com'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r.url   <span class="comment"># response 对象的url </span></span><br><span class="line"><span class="string">'https://github.com/'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r.status_code</span><br><span class="line"><span class="number">200</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r.history</span><br><span class="line">[&lt;Response [<span class="number">301</span>]&gt;]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r.history[<span class="number">0</span>]</span><br><span class="line">[&lt;Response [<span class="number">301</span>]&gt;]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r.history[<span class="number">0</span>].url   <span class="comment"># 查看历史response对象的url</span></span><br><span class="line"><span class="string">'http://github.com/'</span></span><br></pre></td></tr></table></figure>

<p>另外，还可以通过 allow_redirects 参数禁用重定向处理：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.get(<span class="string">'http://github.com'</span>, allow_redirects=<span class="literal">False</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r.status_code</span><br><span class="line"><span class="number">301</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r.history</span><br><span class="line">[]</span><br></pre></td></tr></table></figure>

<h4 id="5-4-6-状态码判断"><a href="#5-4-6-状态码判断" class="headerlink" title="5.4.6 状态码判断"></a>5.4.6 状态码判断</h4><p>requests.codes.ok 都对应于HTTP状态码200。</p>
<p>response.status_code  查看状态码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">response = requests.get(<span class="string">'http://www.baidu.com'</span>)</span><br><span class="line">exit() <span class="keyword">if</span> <span class="keyword">not</span> response.status_code == requests.codes.ok <span class="keyword">else</span> print(<span class="string">'Request Successfully'</span>)</span><br></pre></td></tr></table></figure>

<p>status_code.py 源码内包含的状态码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"># Informational.</span><br><span class="line">100: (&apos;continue&apos;,),</span><br><span class="line">101: (&apos;switching_protocols&apos;,),</span><br><span class="line">102: (&apos;processing&apos;,),</span><br><span class="line">103: (&apos;checkpoint&apos;,),</span><br><span class="line">122: (&apos;uri_too_long&apos;, &apos;request_uri_too_long&apos;),</span><br><span class="line">200: (&apos;ok&apos;, &apos;okay&apos;, &apos;all_ok&apos;, &apos;all_okay&apos;, &apos;all_good&apos;, &apos;\\o/&apos;, &apos;✓&apos;),</span><br><span class="line">201: (&apos;created&apos;,),</span><br><span class="line">202: (&apos;accepted&apos;,),</span><br><span class="line">203: (&apos;non_authoritative_info&apos;, &apos;non_authoritative_information&apos;),</span><br><span class="line">204: (&apos;no_content&apos;,),</span><br><span class="line">205: (&apos;reset_content&apos;, &apos;reset&apos;),</span><br><span class="line">206: (&apos;partial_content&apos;, &apos;partial&apos;),</span><br><span class="line">207: (&apos;multi_status&apos;, &apos;multiple_status&apos;, &apos;multi_stati&apos;, &apos;multiple_stati&apos;),</span><br><span class="line">208: (&apos;already_reported&apos;,),</span><br><span class="line">226: (&apos;im_used&apos;,),</span><br><span class="line"></span><br><span class="line"># Redirection.</span><br><span class="line">300: (&apos;multiple_choices&apos;,),</span><br><span class="line">301: (&apos;moved_permanently&apos;, &apos;moved&apos;, &apos;\\o-&apos;),</span><br><span class="line">302: (&apos;found&apos;,),</span><br><span class="line">303: (&apos;see_other&apos;, &apos;other&apos;),</span><br><span class="line">304: (&apos;not_modified&apos;,),</span><br><span class="line">305: (&apos;use_proxy&apos;,),</span><br><span class="line">306: (&apos;switch_proxy&apos;,),</span><br><span class="line">307: (&apos;temporary_redirect&apos;, &apos;temporary_moved&apos;, &apos;temporary&apos;),</span><br><span class="line">308: (&apos;permanent_redirect&apos;,</span><br><span class="line">      &apos;resume_incomplete&apos;, &apos;resume&apos;,),  # These 2 to be removed in 3.0</span><br><span class="line"></span><br><span class="line"># Client Error.</span><br><span class="line">400: (&apos;bad_request&apos;, &apos;bad&apos;),</span><br><span class="line">401: (&apos;unauthorized&apos;,),</span><br><span class="line">402: (&apos;payment_required&apos;, &apos;payment&apos;),</span><br><span class="line">403: (&apos;forbidden&apos;,),</span><br><span class="line">404: (&apos;not_found&apos;, &apos;-o-&apos;),</span><br><span class="line">405: (&apos;method_not_allowed&apos;, &apos;not_allowed&apos;),</span><br><span class="line">406: (&apos;not_acceptable&apos;,),</span><br><span class="line">407: (&apos;proxy_authentication_required&apos;, &apos;proxy_auth&apos;, &apos;proxy_authentication&apos;),</span><br><span class="line">408: (&apos;request_timeout&apos;, &apos;timeout&apos;),</span><br><span class="line">409: (&apos;conflict&apos;,),</span><br><span class="line">410: (&apos;gone&apos;,),</span><br><span class="line">411: (&apos;length_required&apos;,),</span><br><span class="line">412: (&apos;precondition_failed&apos;, &apos;precondition&apos;),</span><br><span class="line">413: (&apos;request_entity_too_large&apos;,),</span><br><span class="line">414: (&apos;request_uri_too_large&apos;,),</span><br><span class="line">415: (&apos;unsupported_media_type&apos;, &apos;unsupported_media&apos;, &apos;media_type&apos;),</span><br><span class="line">416: (&apos;requested_range_not_satisfiable&apos;, &apos;requested_range&apos;, &apos;range_not_satisfiable&apos;),</span><br><span class="line">417: (&apos;expectation_failed&apos;,),</span><br><span class="line">418: (&apos;im_a_teapot&apos;, &apos;teapot&apos;, &apos;i_am_a_teapot&apos;),</span><br><span class="line">421: (&apos;misdirected_request&apos;,),</span><br><span class="line">422: (&apos;unprocessable_entity&apos;, &apos;unprocessable&apos;),</span><br><span class="line">423: (&apos;locked&apos;,),</span><br><span class="line">424: (&apos;failed_dependency&apos;, &apos;dependency&apos;),</span><br><span class="line">425: (&apos;unordered_collection&apos;, &apos;unordered&apos;),</span><br><span class="line">426: (&apos;upgrade_required&apos;, &apos;upgrade&apos;),</span><br><span class="line">428: (&apos;precondition_required&apos;, &apos;precondition&apos;),</span><br><span class="line">429: (&apos;too_many_requests&apos;, &apos;too_many&apos;),</span><br><span class="line">431: (&apos;header_fields_too_large&apos;, &apos;fields_too_large&apos;),</span><br><span class="line">444: (&apos;no_response&apos;, &apos;none&apos;),</span><br><span class="line">449: (&apos;retry_with&apos;, &apos;retry&apos;),</span><br><span class="line">450: (&apos;blocked_by_windows_parental_controls&apos;, &apos;parental_controls&apos;),</span><br><span class="line">451: (&apos;unavailable_for_legal_reasons&apos;, &apos;legal_reasons&apos;),</span><br><span class="line">499: (&apos;client_closed_request&apos;,),</span><br><span class="line"></span><br><span class="line"># Server Error.</span><br><span class="line">500: (&apos;internal_server_error&apos;, &apos;server_error&apos;, &apos;/o\\&apos;, &apos;✗&apos;),</span><br><span class="line">501: (&apos;not_implemented&apos;,),</span><br><span class="line">502: (&apos;bad_gateway&apos;,),</span><br><span class="line">503: (&apos;service_unavailable&apos;, &apos;unavailable&apos;),</span><br><span class="line">504: (&apos;gateway_timeout&apos;,),</span><br><span class="line">505: (&apos;http_version_not_supported&apos;, &apos;http_version&apos;),</span><br><span class="line">506: (&apos;variant_also_negotiates&apos;,),</span><br><span class="line">507: (&apos;insufficient_storage&apos;,),</span><br><span class="line">509: (&apos;bandwidth_limit_exceeded&apos;, &apos;bandwidth&apos;),</span><br><span class="line">510: (&apos;not_extended&apos;,),</span><br><span class="line">511: (&apos;network_authentication_required&apos;, &apos;network_auth&apos;, &apos;network_authentication&apos;),</span><br></pre></td></tr></table></figure>

<h4 id="5-4-7-获取Cookie"><a href="#5-4-7-获取Cookie" class="headerlink" title="5.4.7 获取Cookie"></a>5.4.7 获取Cookie</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">response = requests.get(<span class="string">"https://www.baidu.com"</span>)</span><br><span class="line">print(response.cookies)</span><br><span class="line"><span class="keyword">for</span> key, value <span class="keyword">in</span> response.cookies.items():</span><br><span class="line">    print(key + <span class="string">"="</span> + value)</span><br></pre></td></tr></table></figure>

<p>结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;RequestsCookieJar[&lt;Cookie BDORZ=27315 for .baidu.com/&gt;]&gt;</span><br><span class="line">BDORZ=27315</span><br><span class="line">``` </span><br><span class="line">### 5.5 其他</span><br><span class="line"> </span><br><span class="line">#### 5.5.1 证书验证</span><br><span class="line">如果使用request 请求时，如果是https协议，会进行一个证书验证的过程，可能会报SSLErroL的错误</span><br><span class="line"></span><br><span class="line">#### 5.5.2 设置代理</span><br><span class="line">```python</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line"># 指定代理IP</span><br><span class="line">proxies = &#123;</span><br><span class="line">    &apos;http&apos;: &apos;http://localhost:8888&apos;, </span><br><span class="line">    &apos;https&apos;: &apos;http://localhost:8888&apos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">url = &apos;http://www.baidu.com&apos;</span><br><span class="line"># proxies ：设置代理的参数，下面的请求使用了代理</span><br><span class="line">requests.post(url, proxies=proxies, verify=False) #verify是否验证服务器的SSL证书</span><br></pre></td></tr></table></figure>

<p>如果代理有用户名和密码，通过如下的方式进行设置</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">'http'</span>: <span class="string">'http://user:password@127.0.0.1:8888'</span>, </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://www.baidu.com'</span></span><br><span class="line">response =  requests.get(url, proxies=proxies)</span><br><span class="line">print(response.status_code)</span><br></pre></td></tr></table></figure>

<p>如果是socks代理，需要先安装一个模块后，进行测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">安装  pip install requests[socks]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果代理有用户名和密码，通过如下的方式进行设置</span></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">'http'</span>: <span class="string">'socks5://localhost:8888'</span>, </span><br><span class="line">    <span class="string">'https'</span>: <span class="string">'socks5://localhost:8888'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://www.baidu.com'</span></span><br><span class="line">response =  requests.get(url, proxies=proxies)</span><br><span class="line">print(response.status_code)</span><br></pre></td></tr></table></figure>

<h4 id="5-5-3-设置超时"><a href="#5-5-3-设置超时" class="headerlink" title="5.5.3 设置超时"></a>5.5.3 设置超时</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">'http://www.baidu.com'</span>,timeout=<span class="number">0.1</span>)  <span class="comment"># 设置超时时间0.1s</span></span><br><span class="line">print(response.status_code)</span><br></pre></td></tr></table></figure>

<h4 id="5-5-4-认证设置"><a href="#5-5-4-认证设置" class="headerlink" title="5.5.4 认证设置"></a>5.5.4 认证设置</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">'http://120.27.34.24:9001'</span>, auth=(<span class="string">'user'</span>, <span class="string">'123'</span>))</span><br><span class="line">print(r.status_code)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">r = requests.get(&apos;http://120.27.34.24:9001&apos;, auth=(&apos;user&apos;, &apos;123&apos;))</span><br><span class="line">print(r.status_code)</span><br></pre></td></tr></table></figure>

<h4 id="5-5-5-异常处理"><a href="#5-5-5-异常处理" class="headerlink" title="5.5.5 异常处理"></a>5.5.5 异常处理</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.exceptions <span class="keyword">import</span> ReadTimeout, ConnectionError, RequestException</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = requests.get(<span class="string">"http://httpbin.org/get"</span>, timeout = <span class="number">0.5</span>)</span><br><span class="line">    print(response.status_code)</span><br><span class="line"><span class="keyword">except</span> ReadTimeout:</span><br><span class="line">    print(<span class="string">'Timeout'</span>)</span><br><span class="line"><span class="keyword">except</span> ConnectionError:</span><br><span class="line">    print(<span class="string">'Connection error'</span>)</span><br><span class="line"><span class="keyword">except</span> RequestException:</span><br><span class="line">    print(<span class="string">'Error'</span>)</span><br></pre></td></tr></table></figure>

<h2 id="应用案例"><a href="#应用案例" class="headerlink" title="应用案例"></a>应用案例</h2><h3 id="1、模拟GitHub登录，获取登录信息"><a href="#1、模拟GitHub登录，获取登录信息" class="headerlink" title="1、模拟GitHub登录，获取登录信息"></a>1、模拟GitHub登录，获取登录信息</h3><p>1、github 的cook 是保存在页面当中，有个标签”name=authenticity_token”；<br>2、github登录后，网址还是github.com；在登录时，后端会返回一个session 信息，之后自动登录到自己的页面中；这个过程中，会有个自动跳转，无法捕获session ;<br>chrome有preserve log 这个选项,会报存跳转之前的数据；从中获取cook信息；<br>3、请求访问</p>
<p>模拟github登录分为三步：</p>
<p>1 get 请求访问  <a href="http://github.com/login" target="_blank" rel="noopener">http://github.com/login</a><br>2 post 请求访问 <a href="https://github.com/session" target="_blank" rel="noopener">https://github.com/session</a><br>3 get 请求访问 <a href="http://github.com" target="_blank" rel="noopener">http://github.com</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment">#请求1:</span></span><br><span class="line">r1=requests.get(<span class="string">'https://github.com/login'</span>)</span><br><span class="line">r1_cookie=r1.cookies.get_dict() <span class="comment">#拿到初始cookie(未被授权)</span></span><br><span class="line">authenticity_token=re.findall(<span class="string">r'name="authenticity_token".*?value="(.*?)"'</span>,r1.text)[<span class="number">0</span>] <span class="comment">#从页面中拿到CSRF TOKEN</span></span><br><span class="line">print(<span class="string">"authenticity_token"</span>,authenticity_token)</span><br><span class="line"><span class="comment">#第二次请求：带着初始cookie和TOKEN发送POST请求给登录页面，带上账号密码</span></span><br><span class="line">data=&#123;</span><br><span class="line">    <span class="string">'commit'</span>:<span class="string">'Sign in'</span>,</span><br><span class="line">    <span class="string">'utf8'</span>:<span class="string">'✓'</span>,</span><br><span class="line">    <span class="string">'authenticity_token'</span>:authenticity_token,</span><br><span class="line">    <span class="string">'login'</span>:<span class="string">'xxxx@163.com'</span>,   <span class="comment"># Github 的用户名和密码</span></span><br><span class="line">    <span class="string">'password'</span>:<span class="string">'xxxxx'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 请求2:</span></span><br><span class="line">r2=requests.post(<span class="string">'https://github.com/session'</span>,</span><br><span class="line">             data=data,</span><br><span class="line">             cookies=r1_cookie,</span><br><span class="line">             <span class="comment"># allow_redirects=False</span></span><br><span class="line">             )</span><br><span class="line">print(r2.status_code)      <span class="comment">#200</span></span><br><span class="line">print(r2.url)              <span class="comment">#看到的是跳转后的页面:https://github.com/</span></span><br><span class="line">print(r2.history)          <span class="comment">#看到的是跳转前的response:[&lt;Response [302]&gt;]</span></span><br><span class="line">print(r2.history[<span class="number">0</span>].text)  <span class="comment">#看到的是跳转前的response.text</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"result.html"</span>,<span class="string">"wb"</span>) <span class="keyword">as</span> f:</span><br><span class="line"></span><br><span class="line">    f.write(r2.content)</span><br></pre></td></tr></table></figure>

<h3 id="2、爬取豆瓣电影信息"><a href="#2、爬取豆瓣电影信息" class="headerlink" title="2、爬取豆瓣电影信息"></a>2、爬取豆瓣电影信息</h3><p>一段豆瓣T250 的html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"pic"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">em</span> <span class="attr">class</span>=<span class="string">""</span>&gt;</span>1<span class="tag">&lt;/<span class="name">em</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://movie.douban.com/subject/1292052/"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">img</span> <span class="attr">width</span>=<span class="string">"100"</span> <span class="attr">alt</span>=<span class="string">"肖申克的救赎"</span> <span class="attr">src</span>=<span class="string">"https://img3.doubanio.com/view/photo/s_ratio_poster/public/p480747492.webp"</span> <span class="attr">class</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"info"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"hd"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://movie.douban.com/subject/1292052/"</span> <span class="attr">class</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"title"</span>&gt;</span>肖申克的救赎<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"title"</span>&gt;</span>&amp;nbsp;/&amp;nbsp;The Shawshank Redemption<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"other"</span>&gt;</span>&amp;nbsp;/&amp;nbsp;月黑高飞(港)  /  刺激1995(台)<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"playable"</span>&gt;</span>[可播放]<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"bd"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">					导演: 弗兰克·德拉邦特 Frank Darabont&amp;nbsp;&amp;nbsp;&amp;nbsp;主演: 蒂姆·罗宾斯 Tim Robbins /...<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">					1994&amp;nbsp;/&amp;nbsp;美国&amp;nbsp;/&amp;nbsp;犯罪 剧情</span><br><span class="line">				<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">				</span><br><span class="line">				<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"star"</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"rating5-t"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"rating_num"</span> <span class="attr">property</span>=<span class="string">"v:average"</span>&gt;</span>9.6<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">span</span> <span class="attr">property</span>=<span class="string">"v:best"</span> <span class="attr">content</span>=<span class="string">"10.0"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">span</span>&gt;</span>1151286人评价<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">					<span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"quote"</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"inq"</span>&gt;</span>希望让人自由。<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line">pool=ThreadPoolExecutor(<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getPage</span><span class="params">(url)</span>:</span></span><br><span class="line"></span><br><span class="line">    response=requests.get(url)</span><br><span class="line">    <span class="keyword">return</span> response.text</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parsePage</span><span class="params">(res)</span>:</span></span><br><span class="line">    <span class="comment"># 通过有名分组的方式获取数据，re.S 模式下的"." 能够识别换行符</span></span><br><span class="line">    com=re.compile(<span class="string">'&lt;div class="item"&gt;.*?&lt;div class="pic"&gt;.*?&lt;em .*?&gt;(?P&lt;id&gt;\d+).*?&lt;span class="title"&gt;(?P&lt;title&gt;.*?)&lt;/span&gt;'</span></span><br><span class="line">                   <span class="string">'.*?&lt;span class="rating_num" .*?&gt;(?P&lt;rating_num&gt;.*?)&lt;/span&gt;.*?&lt;span&gt;(?P&lt;comment_num&gt;.*?)评价&lt;/span&gt;'</span>,re.S)</span><br><span class="line"></span><br><span class="line">    iter_result=com.finditer(res)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> iter_result</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_movie_info</span><span class="params">(iter_result)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> iter_result:</span><br><span class="line">        <span class="keyword">yield</span> &#123;</span><br><span class="line">            <span class="string">"id"</span>:i.group(<span class="string">"id"</span>),</span><br><span class="line">            <span class="string">"title"</span>:i.group(<span class="string">"title"</span>),</span><br><span class="line">            <span class="string">"rating_num"</span>:i.group(<span class="string">"rating_num"</span>),</span><br><span class="line">            <span class="string">"comment_num"</span>:i.group(<span class="string">"comment_num"</span>),</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">stored</span><span class="params">(gen)</span>:</span></span><br><span class="line">        <span class="keyword">with</span> open(<span class="string">"move_info.txt"</span>,<span class="string">"a"</span>,encoding=<span class="string">"utf8"</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">for</span> line <span class="keyword">in</span> gen:</span><br><span class="line">                data=json.dumps(line,ensure_ascii=<span class="literal">False</span>)</span><br><span class="line">                f.write(data+<span class="string">"\n"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">spider_movie_info</span><span class="params">(url)</span>:</span></span><br><span class="line">    res=getPage(url)</span><br><span class="line">    iter_result=parsePage(res)</span><br><span class="line">    gen=gen_movie_info(iter_result)</span><br><span class="line">    stored(gen)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(num)</span>:</span></span><br><span class="line"></span><br><span class="line">    url=<span class="string">'https://movie.douban.com/top250?start=%s&amp;filter='</span>%num</span><br><span class="line">    pool.submit(spider_movie_info,url)</span><br><span class="line">    <span class="comment">#spider_movie_info(url)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    before=time.time()</span><br><span class="line">    count=<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        main(count)</span><br><span class="line">        count+=<span class="number">25</span></span><br><span class="line">    after=time.time()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"总共耗费时间："</span>,after-before)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_html</span><span class="params">(url)</span>:</span></span><br><span class="line"></span><br><span class="line">    response=requests.get(url)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> response.text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parser_html</span><span class="params">(res_html)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#print(res_html)</span></span><br><span class="line"></span><br><span class="line">    ret=re.findall(<span class="string">'&lt;div class="item"&gt;.*?&lt;a href="(.*?)"&gt;.*?&lt;span class="title"&gt;(.*?)&lt;/span&gt;.*?&lt;span class="rating_num".*?&gt;(.*?)&lt;/span&gt;.*?&lt;span&gt;(.*?)人评价&lt;/span&gt;'</span>,res_html,re.S)</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">store</span><span class="params">(data)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">"douban.txt"</span>,<span class="string">"a"</span>,encoding=<span class="string">"utf8"</span>) <span class="keyword">as</span> f:</span><br><span class="line">         <span class="keyword">for</span> item <span class="keyword">in</span> data:</span><br><span class="line">             s=<span class="string">" "</span>.join(list(item))</span><br><span class="line">             line=s+<span class="string">"\n"</span></span><br><span class="line">             print(line)</span><br><span class="line">             f.write(line)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line"></span><br><span class="line">    index=<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span>  i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line"></span><br><span class="line">        url=<span class="string">"https://movie.douban.com/top250?start=%s&amp;filter="</span>%index</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 1 爬取资源</span></span><br><span class="line"></span><br><span class="line">        res_html=get_html(url)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 2 解析资源</span></span><br><span class="line"></span><br><span class="line">        data=parser_html(res_html)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 3 持久化</span></span><br><span class="line">        store(data)</span><br><span class="line"></span><br><span class="line">        index+=<span class="number">25</span></span><br></pre></td></tr></table></figure>

<h3 id="3、爬取拉钩网"><a href="#3、爬取拉钩网" class="headerlink" title="3、爬取拉钩网"></a>3、爬取拉钩网</h3><p>经过查找发现，拉钩网的职位信息是是通过ajax 获取的（主页面没有数据，有个ajax 数据）；</p>
<p>在浏览器上点击XHR(ajax对象)，过滤出该ajax 的数据，找出有职位的数据ajax；<br>从该ajax 的数据上看：<br>Headers 》request headers 下<br>Referer:<a href="https://www.lagou.com/jobs/list_pyton?labelWords=&amp;fromSearch=true&amp;suginput=" target="_blank" rel="noopener">https://www.lagou.com/jobs/list_pyton?labelWords=&amp;fromSearch=true&amp;suginput=</a><br>得知中间跳转了一个网址 <a href="https://www.lagou.com/jobs/list_pyton" target="_blank" rel="noopener">https://www.lagou.com/jobs/list_pyton</a><br>Form Data:   # post 请求提交的数据，如果不加，返回的是网站默认的职位数据，不是python<br>first:true<br>pn:1<br>kd:pyton  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">session=requests.session()   <span class="comment"># 使用session 获取cookie </span></span><br><span class="line">session.get(<span class="string">"https://www.lagou.com/"</span>)  <span class="comment"># 第一次访问主站获取携带cookie</span></span><br><span class="line">session.get(<span class="string">"https://www.lagou.com/jobs/list_python"</span>) <span class="comment"># 获取进行跳转的的cokie</span></span><br><span class="line"></span><br><span class="line">res=session.post(<span class="string">"https://www.lagou.com/jobs/positionAjax.json?px=default&amp;city=%E5%8C%97%E4%BA%AC&amp;needAddtionalResult=false"</span>,</span><br><span class="line">                  headers=&#123;</span><br><span class="line">                            <span class="string">"Referer"</span>: <span class="string">"https://www.lagou.com/jobs/list_python?labelWords=&amp;fromSearch=true&amp;suginput="</span>,</span><br><span class="line">                            <span class="string">"User-Agent"</span>:<span class="string">"Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36"</span></span><br><span class="line">                  &#125;,</span><br><span class="line">                  data=&#123;</span><br><span class="line">                    <span class="string">"first"</span>: <span class="string">"true"</span>,</span><br><span class="line">                    <span class="string">"pn"</span>:<span class="number">1</span>,</span><br><span class="line">                    <span class="string">"kd"</span>:<span class="string">"python"</span>,  <span class="comment">#查询的条件，如果不加，返回的json 数据不是python，而是全网的默认的</span></span><br><span class="line">                    &#125;</span><br><span class="line">                  )</span><br><span class="line"></span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure>

<h3 id="登录豆瓣访问主义"><a href="#登录豆瓣访问主义" class="headerlink" title="登录豆瓣访问主义"></a>登录豆瓣访问主义</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">s = requests.Session()</span><br><span class="line">url_login = <span class="string">'https://accounts.douban.com/j/mobile/login/basic'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">formdata = &#123;</span><br><span class="line">    <span class="string">"ck"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"18610984857"</span>,</span><br><span class="line">    <span class="string">"password"</span>: <span class="string">"123456"</span>,</span><br><span class="line">    <span class="string">"remember"</span> : <span class="string">"false"</span>,</span><br><span class="line">    <span class="string">"ticket"</span>: <span class="string">""</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'user-agent'</span> : <span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.120 Safari/537.36"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">r = s.post(url_login,data=formdata,headers = headers)</span><br><span class="line">content = r.text</span><br><span class="line">uid = json.loads(content).get(<span class="string">"payload"</span>).get(<span class="string">"account_info"</span>).get(<span class="string">"uid"</span>)</span><br><span class="line"></span><br><span class="line">url_contacts = <span class="string">"https://www.douban.com/people/%s/"</span> % uid</span><br><span class="line">html = s.get(url_contacts,headers = headers)</span><br><span class="line">print(html.text)</span><br></pre></td></tr></table></figure></div><div class="post-copyright"><blockquote><p>原文作者: 吴泰</p><p>原文链接: <a href="http://yoursite.com/2019/10/27/05-基础模块之Request模块和Response响应/">http://yoursite.com/2019/10/27/05-基础模块之Request模块和Response响应/</a></p><p>版权声明: 转载请注明出处(必须保留原文作者署名原文链接)</p></blockquote></div><div class="tags"><a href="/tags/爬虫/">爬虫</a></div><div class="post-share"><div class="social-share"><span>分享到:</span></div></div><div class="post-nav"><a href="/2019/10/27/06 BeautifulSoup 模块的使用/" class="pre">06 BeautifulSoup 模块的使用</a><a href="/2019/10/27/04-基础模块之-Urllib/" class="next">04 基础模块之 Urllib</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#5、request-模块"><span class="toc-text">5、request 模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-基本语法"><span class="toc-text">5.1 基本语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-get请求"><span class="toc-text">5.2 get请求</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-1、基本请求"><span class="toc-text">5.2.1、基本请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-2、含参数的请求"><span class="toc-text">5.2.2、含参数的请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-3、含请求头的请求"><span class="toc-text">5.2.3、含请求头的请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-4、-含cookies请求"><span class="toc-text">5.2.4、 含cookies请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-5、-request-session"><span class="toc-text">5.2.5、 request.session()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-post请求"><span class="toc-text">5.3 post请求</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-1-data参数"><span class="toc-text">5.3.1 data参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-2-发送json数据"><span class="toc-text">5.3.2 发送json数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-3-文件上传"><span class="toc-text">5.3.3  文件上传</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-Response对象"><span class="toc-text">5.4 Response对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-1-常见属性"><span class="toc-text">5.4.1 常见属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-2-编码问题"><span class="toc-text">5.4.2 编码问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-3-下载二进制文件（图片，视频，音频）"><span class="toc-text">5.4.3 下载二进制文件（图片，视频，音频）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-4-解析json数据"><span class="toc-text">5.4.4 解析json数据　　</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-5-Redirection-and-History"><span class="toc-text">5.4.5 Redirection and History</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-6-状态码判断"><span class="toc-text">5.4.6 状态码判断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-7-获取Cookie"><span class="toc-text">5.4.7 获取Cookie</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-3-设置超时"><span class="toc-text">5.5.3 设置超时</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-4-认证设置"><span class="toc-text">5.5.4 认证设置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-5-异常处理"><span class="toc-text">5.5.5 异常处理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#应用案例"><span class="toc-text">应用案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、模拟GitHub登录，获取登录信息"><span class="toc-text">1、模拟GitHub登录，获取登录信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、爬取豆瓣电影信息"><span class="toc-text">2、爬取豆瓣电影信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3、爬取拉钩网"><span class="toc-text">3、爬取拉钩网</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#登录豆瓣访问主义"><span class="toc-text">登录豆瓣访问主义</span></a></li></ol></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/10/27/11-正则解析html/">11 正则解析html</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/27/13-Scrapy-爬取知乎用户信息/">13 Scrapy 爬取知乎用户信息</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/27/12-scrapy-框架基础知识/"> 12 scrapy 框架基础知识</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/27/实战1-Requests-正则表达式抓取猫眼TOP100/">10 实战1 Requests+正则表达式抓取猫眼TOP100</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/27/09-selinux-模块/">09  selinux 模块</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/27/08 解析模块之Xpath 模块/">08 解析模块之Xpath 模块</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/27/07 PyQuery  模块的使用/">07 PyQuery  模块的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/27/06 BeautifulSoup 模块的使用/">06 BeautifulSoup 模块的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/27/05-基础模块之Request模块和Response响应/">05 基础模块之Request模块和Response响应</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/27/04-基础模块之-Urllib/">04 基础模块之 Urllib</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/爬虫/">爬虫</a><span class="category-list-count">13</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/Anaconda/" style="font-size: 15px;">Anaconda</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/爬虫/" style="font-size: 15px;">爬虫</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |  <a href="/atom.xml">订阅本站</a> |  <a href="/about/">联系博主</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次，本站总访客数:<i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>人</p><p><span> Copyright &copy;<a href="/." rel="nofollow">吴泰.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.4"></script><script type="text/javascript" id="maid-script" src="https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js?v=2.0.4"></script><script>if (window.mermaid) {
  var options = JSON.parse(document.getElementById('maid-script').getAttribute('mermaidoptioins'));
  mermaid.initialize(options);
}</script><script type="text/javascript" src="/js/toctotop.js?v=2.0.4" async></script><link rel="stylesheet" type="text/css" href="/share/css/share.css"><script type="text/javascript" src="/share/js/social-share.js" charset="utf-8"></script><script type="text/javascript" src="/share/js/qrcode.js" charset="utf-8"></script></body></html>